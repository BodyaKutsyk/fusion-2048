var e={GameClass:class{constructor(e){this.HTML_CELLS=e,this.HTML_MATRIX=[],this.madeMove=!1,this.isGameStarted=!1,this.winStatus=!1,this.score=0}randomNumber(e,t){return Math.floor(Math.random()*(t-e)+e)}static makeMatrix(e){let t=[],r=0;if(!e)for(let e=0;e<4;e++){t.push([]);for(let r=0;r<4;r++)t[e].push(0)}if(e)for(let l=0;l<e.length/4;l++){t.push([]);for(let o=0;o<e.length/4;o++)t[l].push(e[r]),r++}return t}rotateMatrix(e){let t=e.map(e=>[...e]);for(let r=0;r<e.length;r++)for(let l=0;l<e[r].length;l++)t[r][l]=e[e.length-1-l][r];return t}reverseRotate(e){let t=e.map(e=>[...e]);for(let r=0;r<e.length;r++)for(let l=0;l<e[r].length;l++)t[r][l]=e[l][e[r].length-1-r];return t}randomCell(e){let t=[];for(let r=0;r<e.length;r++){let l=[r];for(let t=0;t<e[r].length;t++)0===e[r][t]&&l.push(t);l.length>1&&t.push(l)}let r=this.randomNumber(0,t.length),l=t[r];if(l){let t=this.randomNumber(1,l.length),r=.9>Math.random()?2:4,o=l[0],i=l[t];return e[o][i]=r,[o,i]}}canMoveVerticaly(e){for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length-1;r++)if(e[t][r]===e[t][r+1])return!0;return!1}canMoveHorizontaly(e){for(let t=0;t<e.length-1;t++)for(let r=0;r<e[t].length;r++)if(e[t][r]===e[t+1][r])return!0;return!1}hasEmptySpace(e){for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++)if(0===e[t][r])return!0;return!1}moveLeft(e,t,r,l){let o=this.moveList,i=e[t];for(let e=0;e<i.length;e++)if(0!==i[e]){let s=e;for(let n=e-1;n>=0;n--)if(0===i[n]&&(!l&&(i[n]=i[s],o[t][e]++,i[s]=0,r[e].after||(r[e].after=e,r[e].before=e),r[e].after--,r[e].before=e,s--),l)){let l=!0;if(i[n]=i[s],i[s]=0,r.forEach(e=>{e.after===s&&(o[t][e.before]++,l=!1)}),l)for(let r=e;r<i.length;r++)0===i[r]&&o[t][r]++}}return i}moveRight(e,t,r,l){let o=this.moveList,i=e[t];for(let e=i.length-1;e>=0;e--)if(0!==i[e]){let s=e;for(let n=e+1;n<i.length;n++)if(0===i[n]&&(!l&&(i[n]=i[s],o[t][e]++,i[s]=0,r[e].after||(r[e].after=e),r[e].after++,r[e].before=e,s++),l)){let l=!0;if(i[n]=i[s],i[s]=0,r.forEach(e=>{e.after===s&&(o[t][e.before]++,l=!1)}),l)for(let r=e;r>=0;r--)0===i[r]&&o[t][r]++}}return i}mergeLeft(e,t,r){for(let l=0;l<e.length;l++)if(e[l]===e[l+1]&&0!==e[l]){e[l]+=e[l+1],this.score+=e[l];let o=!0;t.forEach(e=>{e.after===l+1&&(r[e.before]++,o=!1)}),o&&r[l+1]++,e[l+1]=0,l++}}mergeRight(e,t,r){for(let l=e.length-1;l>=0;l--)if(e[l]===e[l-1]&&0!==e[l]){e[l]+=e[l-1],this.score+=e[l];let o=!0;t.forEach(e=>{e.after===l-1&&(r[e.before]++,o=!1)}),o&&r[l-1]++,e[l-1]=0,l--}}moveField(e,t,r){let l=this.rotateMatrix(e);for(let o=0;o<e.length;o++){let i=e[o],s=[{},{},{},{}],n=0;switch(t){case"ArrowLeft":i=this.moveLeft(e,o,s,n),n=1,this.mergeLeft(i,s,r[o]),e[o]=i,e[o]=this.moveLeft(e,o,s,n);break;case"ArrowRight":i=this.moveRight(e,o,s,n),n=1,this.mergeRight(i,s,r[o]),e[o]=i,e[o]=this.moveRight(e,o,s,n);break;case"ArrowUp":i=this.moveRight(l,o,s,n),n=1,this.mergeRight(i,s,r[o]),e[o]=i,e[o]=this.moveRight(l,o,r,s,n);break;case"ArrowDown":i=this.moveLeft(l,o,s,n),n=1,this.mergeLeft(i,s,r[o]),e[o]=i,e[o]=this.moveLeft(l,o,s,n)}}("ArrowUp"===t||"ArrowDown"===t)&&(e.forEach((t,r)=>{e[r]=this.reverseRotate(l)[r]}),this.moveList=this.reverseRotate(r))}visualize(e,t){let r=this.FIELD,l=this.HTML_MATRIX,o=this.moveList,i=t;t||(i=r);let s=0,n=!0;for(let e=0;e<i.length;e++)for(let t=0;t<i[e].length;t++)i[e][t]===r[e][t]&&s++;s===r.length*r.length&&(n=!1);for(let t=0;t<i.length;t++)for(let r=0;r<i[t].length;r++){for(;l[t][r].firstChild;)l[t][r].removeChild(l[t][r].lastChild);let s=document.createElement("div");s.innerText="",s.classList="",i[t][r]>0&&(s.style.zIndex="2",s.innerText=`${i[t][r]}`,this.animateMovement(s,e,o[t][r]),s.classList=`
          field-cell
          field-cell--inner-block
          field-cell--${i[t][r]}`,l[t][r].appendChild(s))}setTimeout(()=>{for(let e=0;e<r.length;e++)for(let t=0;t<r[e].length;t++){let i=l[e][t];for(;i.firstChild;)i.removeChild(i.lastChild);let s=document.createElement("div");s.innerText="",s.classList="",r[e][t]>0&&(s.style.zIndex="2",s.innerText=`${r[e][t]}`,s.classList=`
            field-cell
            field-cell--inner-block
            field-cell--${r[e][t]}`,l[e][t].appendChild(s)),o[e][t]=0}if(this.hasEmptySpace(r)&&n&&this.madeMove){let e=document.createElement("div");setTimeout(()=>{let t=this.randomCell(r);e.innerText=`${r[t[0]][t[1]]}`,e.classList=`
          field-cell
          field-cell--inner-block
          only-created
          field-cell--${r[t[0]][t[1]]}`,l[t[0]][t[1]].appendChild(e)},100)}},50)}animateMovement(e,t,r){let l=85*r,o="",i=0;switch(t){case"ArrowUp":o="top";break;case"ArrowDown":o="bottom";break;case"ArrowLeft":o="left";break;case"ArrowRight":o="right"}e.style[o]="0px",e.style.zIndex="1",setTimeout(()=>{(i+=l/r)>=l&&(i=l),e.style[o]=-l+"px"},10)}checkWinState(){return this.FIELD.forEach(e=>{e.forEach(e=>{2048===e&&(this.winStatus=!0)})}),this.winStatus}}}.GameClass;const t=document.querySelectorAll(".field-cell"),r=new e(t);function l(e){let t=r.FIELD.map(e=>[...e]);r.madeMove=!0,r.moveField(r.FIELD,e.key,r.moveList),r.visualize(e.key,t);for(let e=0;e<r.moveList.length;e++)for(let t=0;t<r.moveList.length;t++)r.moveList[e][t]=0;document.querySelector(".game-score").innerText=`${r.score}`,r.canMoveHorizontaly(r.FIELD)||r.canMoveVerticaly(r.FIELD)||r.hasEmptySpace(r.FIELD)?r.winStatus&&(document.querySelector(".game-field__game-win").style.display="flex",document.removeEventListener("keydown",l),setTimeout(()=>{document.querySelector(".game-field__game-win").style.opacity="1",document.querySelector(".message-win").classList.remove("hidden")},10)):(document.querySelector(".game-field__game-over").style.display="flex",document.removeEventListener("keydown",l),setTimeout(()=>{document.querySelector(".game-field__game-over").style.opacity="1",document.querySelector(".message-lose").classList.remove("hidden")},10))}r.FIELD=e.makeMatrix(),r.moveList=e.makeMatrix(),r.HTML_MATRIX=e.makeMatrix(t),document.body.querySelector(".button").addEventListener("click",()=>{document.querySelector(".message-start").classList.add("hidden"),r.isGameStarted&&(r.FIELD.forEach((e,t)=>{e.forEach((e,l)=>{r.FIELD[t][l]=0})}),t.forEach(e=>{for(e.innerHTML="";e.firstChild;)e.removeChild(e.firstChild)}),document.body.querySelector("button").classList="button start",document.body.querySelector("button").innerHTML="Start",document.body.querySelector(".game-score").innerHTML="0",document.body.querySelector(".game-field__game-over").style.display="none",document.body.querySelector(".game-field__game-win").style.display="none",document.body.querySelector(".message-lose").classList.add("hidden"),document.body.querySelector(".message-win").classList.add("hidden"),r.madeMove=!1,r.score=0),r.madeMove||(setTimeout(()=>{r.randomCell(r.FIELD),r.randomCell(r.FIELD),r.visualize(r.FIELD,r.HTML_MATRIX,r.moveList)},50),document.querySelector(".button").classList="button restart",document.querySelector(".button").innerText="Restart",r.isGameStarted=!0),document.addEventListener("keydown",l)});
//# sourceMappingURL=index.6b14ee4d.js.map
